<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Braille to Speech Converter</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <style>
    .input_image {
      display: block;
      max-width: 100vw;
      max-height: 45vh;
      width: auto;
      height: auto;
    }
  </style>
</head>
<body style="background: #ffffff">
<div class="container">

  <header style="position: fixed;left: 0;top: 0; margin-top: 7px; width: 100%; background-color: #ffffff">
    <h1 align="center" style="color: #5bc0de;">
      <b>Braille to Speech Converter</b>
    </h1>
  </header>

  <br><br><br><br>

  <div align="center" class="container">
    <img id="inputimage" src="/coverimage" class="img-fluid input_image" alt="Raw"/>
    <br>
    <kbd id="output">Click on Convert to get the English text for the above image</kbd>
    <br>

    <div style="margin-top: 20px;margin-bottom: 20px;">
      <input type="file" id="file_input" class="form-control mb-3" oninput="input_filename();">
      <button onclick="upload('/digest');" id="upload_btn" class="btn btn-primary">Convert to Text</button>
      <button id="play_btn" class="btn btn-success mt-2">üîä Play Text</button>
      <a href="https://rahuldev870.github.io/Braille-k/" class="btn btn-outline-info mt-3">‚Üê Back to Homepage</a>
    </div>

    <div id="progress_wrapper" class="d-none">
      <label id="progress_status"></label>
      <div class="progress mb-3">
        <div id="progress" class="progress-bar" role="progressbar"></div>
      </div>
    </div>

    <div id="alert_wrapper"></div>

  </div>

</div>

<footer class="text-center mt-5 mb-3 text-muted">
  <small>CSE1901 - Technical Answers for Real World Problems</small>
</footer>

<script>
  var input = document.getElementById("file_input");
  var input_image = document.getElementById("inputimage");
  var output_text = document.getElementById("output");

  function input_filename() {
    // Optional filename display
  }

  function show_alert(message, type) {
    document.getElementById("alert_wrapper").innerHTML = `
      <div class="alert alert-${type} alert-dismissible fade show" role="alert">
        ${message}
        <button type="button" class="btn-close" data-dismiss="alert" aria-label="Close"></button>
      </div>`;
  }

  function upload(url) {
    if (!input.files.length) {
      show_alert("Please select a file first.", "warning");
      return;
    }

    var data = new FormData();
    data.append("file", input.files[0]);

    var request = new XMLHttpRequest();
    request.responseType = "json";

    request.open("POST", url);
    request.send(data);

    request.onload = function () {
      if (request.status === 200 && request.response) {
        const res = request.response;
        if (res.error) {
          show_alert(res.message, "danger");
        } else {
          input_image.src = '/procimage/' + res.img_id + '?' + Date.now();
          output_text.innerText = res.digest;
          show_alert("Image converted successfully!", "success");
        }
      } else {
        show_alert("Failed to upload file.", "danger");
      }
    };
  }

  document.getElementById("play_btn").addEventListener("click", function () {
    const text = document.getElementById("output").innerText;
    say(text);
  });

  function say(text, rate = 1, pitch = 1) {
    const msg = new SpeechSynthesisUtterance();
    msg.text = text;
    msg.lang = 'en-US';
    msg.rate = rate;
    msg.pitch = pitch;
    window.speechSynthesis.speak(msg);
  }
</script>

</body>
</html>
